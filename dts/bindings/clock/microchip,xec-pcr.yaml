# Copyright (c) 2021, Microchip Technology Inc.
# SPDX-License-Identifier: Apache-2.0

description: Microchip XEC Power Clock Reset and VBAT register (PCR)

compatible: "microchip,xec-pcr"

include:
  - "clock-controller.yaml"
  - "pinctrl-device.yaml"
  - "microchip,dmec-ecia-girq.yaml"

properties:
  reg:
    required: true

  hibtimer-handle:
    type: phandle
    description: |
      Handle to a hibernation timer node used by clock control for timeouts
      during clock configuration.

  core-clock-div:
    type: int
    required: true
    description: Divide 96 MHz PLL clock to produce Cortex-M4 core clock

  slow-clock-div:
    type: int
    description: |
      PWM and TACH clock domain divided down from 48 MHz AHB clock. The
      default value is 480 for 100 kHz.

  pll-32k-src:
    type: int
    required: true
    description: 32 KHz clock source for PLL

  periph-32k-src:
    type: int
    required: true
    description: 32 KHz clock source for peripherals

  xtal-gain:
    type: string
    description: Crystal input amplifier circuit gain
    enum:
      - "4X"
      - "3X"
      - "2X"
      - "1X"

  xtal-single-ended:
    type: boolean
    description: Use single ended crystal connection to XTAL2 pin.

  clk32kmon-period-min:
    type: int
    required: true
    description: |
      32KHz clock monitor minimum valid 32KHz period in 48MHz units

  clk32kmon-period-max:
    type: int
    required: true
    description: |
      32KHz clock monitor maximum valid 32KHz period in 48MHz units

  clk32kmon-duty-cycle-var-max:
    type: int
    required: true
    description: |
      Maximum duty cycle variation. Difference in units of 48HMz between
      the measured 32KHz high and low pulse widths.

  clk32kmon-valid-min:
    type: int
    required: true
    description: |
      Minimum number of consecutive 32KHz pulses that pass all monitor tests

  xtal-enable-delay-ms:
    type: int
    required: true
    default: 10
    description: |
      Delay in milliseconds after crystal is started and before crystal
      is checked.

  xtal-monitor-max-ms:
    type: int
    description: |
      Time interval in milliseconds the driver will check crystal is within
      specified bounds (stable). A value of 0 (default) indicates infinite timeout.

  pll-lock-timeout-ms:
    type: int
    required: true
    default: 30
    description: |
      Timeout in milliseconds waiting for PLL to lock to new clock source.

  internal-osc-disable:
    type: boolean
    description: |
      If the internal silicon 32KHz oscillator is not chosen as the source
      for PLL and Periheral devices then disable the internal 32KHz
      oscillator to save power.

  xtal-hi-startup-current-disable:
    type: boolean
    description: |
      If present disable crystal high startup current afer the crytal is
      stable and PLL has locked.

  pll-src-lock:
    type: boolean
    description: |
      If present the driver will lock the PLL clock source register after
      configuration.

  silosc-en-lock:
    type: boolean
    description: |
      If present after clock configuration the driver will lock the 32KHz
      internal silicon OSC enable bit.

  "#clock-cells":
    const: 3

clock-cells:
  - regidx
  - bitpos
  - domain
